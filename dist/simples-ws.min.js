(function(e,t){if(typeof define==="function"&&define.amd){define("ws",["exports"],t)}else if(typeof exports!=="undefined"){t(exports)}else{var n={exports:{}};t(n.exports);e.ws=n.exports}})(this,function(e){"use strict";Object.defineProperty(e,"__esModule",{value:true});e["default"]=void 0;function o(e){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){o=function e(t){return typeof t}}else{o=function e(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t}}return o(e)}function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}function t(e,t,n){if(t)r(e.prototype,t);if(n)r(e,n);return e}var f="close";var c="error";var u="https:";var l="message";var h="open";var v="s";var p="ws";var y=Error('Uncaught, unspecified "error" event.');var d=Error("Can not parse message");var i=function(){function s(e,t){a(this,s);var n=false;var r=t;var i=[];if(o(e)==="object"){r=e}if(r&&o(r)==="object"){n=r.advanced===true;if(Array.isArray(r.protocols)){i=r.protocols.filter(function(e){return typeof e==="string"})}else if(typeof r.protocols==="string"){i.push(r.protocols)}}this.data={};this._advanced=n;this._events=new Map;this._url=s.normalizeURL(e);this._opening=false;this._protocols=i;this._socket=null;this._started=false}t(s,[{key:"close",value:function e(t,n){if(this._started){this._started=false;this._socket.close(t,n)}return this}},{key:"emit",value:function e(t){var n=this;for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++){i[o-1]=arguments[o]}if(t===c&&!this._events.has(c)){if(i[0]instanceof Error){throw i[0]}else{throw y}}if(this._events.has(t)){this._events.get(t).forEach(function(e){e.apply(n,i)});return true}return false}},{key:"off",value:function e(t,n){if(t&&n){if(this._events.has(t)){var r=this._events.get(t).indexOf(n);if(r>=0){this._events.get(t).splice(r,1)}}}else if(t){if(this._events.has(t)){this._events["delete"](t)}}else{this._events=new Map}return this}},{key:"on",value:function e(t,n){if(typeof n==="function"){var r=this._events.get(t);if(!r){r=[];this._events.set(t,r)}r.push(n)}return this}},{key:"once",value:function e(i,o){var s=this;var t=function e(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++){n[r]=arguments[r]}o.apply(s,n);s.off(i,e)};return this.on(i,t)}},{key:"open",value:function e(t,n){var r=this;var i=n;if(o(t)==="object"){i=t}else if(typeof t==="string"){this._url=s.normalizeURL(t)}if(i&&o(i)==="object"){if(i.advanced){this._advanced=i.advanced===true}if(Array.isArray(i.protocols)){this._protocols=i.protocols.filter(function(e){return typeof e==="string"})}else if(typeof i.protocols==="string"){this._protocols.push(i.protocols)}}this._opening=true;this.close();this._socket=new WebSocket(this._url,this.protocols);this._socket.onclose=function(e){r._started=false;r.emit(f,e)};this._socket.onerror=function(e){r._started=false;r.emit(c,e)};this._socket.onmessage=function(e){if(r._advanced){var t=e;try{t=JSON.parse(t.data)}catch(e){r.emit(c,d)}finally{if(t===e){r.emit(l,e)}else{r.emit(t.event,t.data)}}}else{r.emit(l,e)}};this._socket.onopen=function(e){r._started=true;r._opening=false;r.emit(h,e)};return this}},{key:"send",value:function e(t,n,r){var i=this;if(this._started){try{var o=t;if(this._advanced){o=JSON.stringify({data:n,event:t})}else if(!s.canSend(o)){o=JSON.stringify(o)}this._socket.send(o);if(this._advanced&&typeof r==="function"){this.once(t,r)}}catch(e){this.emit(c,e)}}else{this.once(h,function(){i.send(t,n,r)});if(!this._opening){this.open()}}return this}}],[{key:"canSend",value:function e(t){var n=typeof t==="string";var r=t instanceof ArrayBuffer;var i=ArrayBuffer.isView(t);return n||r||i}},{key:"normalizeURL",value:function e(t){var n=window.location;var r=p;var i=new URL(n.href);if(typeof t==="string"){i=new URL(t,n.href)}if(n.protocol===u){r+=v}i.protocol=r;return i.href}}]);return s}();var n=function e(t,n){return new i(t,n).open()};e["default"]=n});